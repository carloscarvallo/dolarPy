<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DolarPy</title>
    <link rel="stylesheet"
          href="https://storage.googleapis.com/code.getmdl.io/1.0.5/material.green-deep_purple.min.css"/>
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.5/material.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Aldrich'
          rel='stylesheet' type='text/css'>
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> -->
    <script src="/js/jquery.min.js"></script>
    <script src="https://unpkg.com/rxjs/bundles/Rx.min.js"></script>
    <script src="/js/autoNumeric-min.js"></script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- Square card -->
    <style>
        .aldrich {
        font-family: 'Aldrich',"Roboto","Helvetica","Arial",sans-serif
        }
        .dolarpy-card-square.mdl-card {
        width: 320px;
        height: 230px;
        }
        .dolarpy-card-square > .mdl-card__title {
        color: #fff;
        padding-bottom: 16px;
        padding-top: 10px;
        background:
        /*url('/images/dog.png') */
        #46B6AC;
        }
        .mdl-card__title-text.derecha {
        margin-left: auto;
        font-weight: bold;
        }
        .mdl-textfield__input.grande{
        font-size: 40px;
        }
    </style>
</head>
<body style="background-color:#EFEFEF;">
<h1 class="aldrich">ðŸ’¸ DolarPy ðŸ’¸</h1>

<div class="mdl-textfield mdl-js-textfield">
    <input class="mdl-textfield__input grande" type="text"
           id="cuanto"
           data-a-sign="$ " data-a-dec="," data-a-sep="."
           placeholder="Monto"><!-- â‚² -->
    <div class="mdl-tooltip" for="cuanto">
        <strong>Convertir dÃ³lares a guaranÃ­es</strong>
    </div>
</div>


<div class="mdl-grid">
    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="cchaco"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="vchaco"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Cambios Chaco
                </a>
            </div>
        </div>

    </div>

    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="calberdi"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="valberdi"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Cambios Alberdi
                </a>
            </div>
        </div>

    </div>

    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="cmaxi"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="vmaxi"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Maxicambios
                </a>
            </div>
        </div>

    </div>

    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="cbcp"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="vbcp"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Ref DÃ­a:

                <div class="mdl-card__title-text derecha"><span
                        id="refbcp"></span></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    BCP
                </a>
            </div>
        </div>

    </div>

    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="cset"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="vset"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    SET
                </a>
            </div>
        </div>

    </div>


    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="intcompra"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="intventa"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Interfisa
                </a>
            </div>
        </div>

    </div>

    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="ambcompra"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="ambventa"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Amambay
                </a>
            </div>
        </div>

    </div>


    <div class="mdl-cell mdl-cell--3-col">

        <div class="dolarpy-card-square mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Compra:

                <div class="mdl-card__title-text derecha" id="mydcompra"></div>
                </p>
            </div>
            <div class="mdl-card__title mdl-card--expand">
                <p class="mdl-card__title-text">Venta:

                <div class="mdl-card__title-text derecha" id="mydventa"></div>
                </p>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    MyD Cambios
                </a>
            </div>
        </div>

    </div>

</div>
<h6>Actualizado: <span id="updated"></span></h6>
<h5 id="algo">Webservice en <a href="/api/1.0/">https://dolar.melizeche.com/api/1.0/</a></h5>
<h5 id="algo">Twitter bot <a href="https://twitter.com/dolarpy">@DolarPy</a></h5>
<h5 id="algo">CÃ³digo en <a href="https://github.com/melizeche/dolarPy">Github</a></h5>

<script type="text/javascript">
(function ($) {

/*
Sorry, I suck at javascript :'(
*/

    const $cchaco = $("#cchaco")
    const $vchaco = $("#vchaco")
    const $calberdi = $("#calberdi")
    const $valberdi = $("#valberdi")
    const $cmaxi = $("#cmaxi")
    const $vmaxi = $("#vmaxi")
    const $cbcp = $("#cbcp")
    const $vbcp = $("#vbcp")
    const $refbcp = $("#refbcp")
    const $cset = $("#cset")
    const $vset = $("#vset")
    const $intcompra = $("#intcompra")
    const $intventa = $("#intventa")
    const $ambcompra = $("#ambcompra")
    const $ambventa = $("#ambventa")
    const $mydcompra = $("#mydcompra")
    const $mydventa = $("#mydventa")

    const $updated = $("#updated")
    const $cuanto = $("#cuanto")

    const $inputStream = Rx.Observable.fromEvent($cuanto, 'keyup')

    function getCoti (cb) {
        $.get("/api/1.0/", function (json) {
            var api = {}
            var dolarPyJson = json.dolarpy

            api.cchaco = dolarPyJson.cambioschaco.compra
            api.vchaco = dolarPyJson.cambioschaco.venta
            api.calberdi = dolarPyJson.cambiosalberdi.compra
            api.valberdi = dolarPyJson.cambiosalberdi.venta
            api.cmaxi = dolarPyJson.maxicambios.compra
            api.vmaxi = dolarPyJson.maxicambios.venta
            api.cbcp = dolarPyJson.bcp.compra
            api.vbcp = dolarPyJson.bcp.venta
            api.refbcp = dolarPyJson.bcp.referencial_diario
            api.cset = dolarPyJson.set.compra
            api.vset = dolarPyJson.set.venta
            api.intcompra = dolarPyJson.interfisa.compra
            api.intventa = dolarPyJson.interfisa.venta
            api.ambcompra = dolarPyJson.amambay.compra
            api.ambventa = dolarPyJson.amambay.venta
            api.mydcompra = dolarPyJson.mydcambios.compra
            api.mydventa = dolarPyJson.mydcambios.venta

            $cchaco.text(api.cchaco).autoNumeric('init')
            $vchaco.text(api.vchaco).autoNumeric('init')
            $calberdi.text(api.calberdi).autoNumeric('init')
            $valberdi.text(api.valberdi).autoNumeric('init')
            $cmaxi.text(api.cmaxi).autoNumeric('init')
            $vmaxi.text(api.vmaxi).autoNumeric('init')
            $cbcp.text(api.cbcp).autoNumeric('init')
            $vbcp.text(api.vbcp).autoNumeric('init')
            $refbcp.text(api.refbcp).autoNumeric('init')
            $cset.text(api.cset).autoNumeric('init')
            $vset.text(api.vset).autoNumeric('init')
            $intcompra.text(api.intcompra).autoNumeric('init')
            $intventa.text(api.intventa).autoNumeric('init')
            $ambcompra.text(api.ambcompra).autoNumeric('init')
            $ambventa.text(api.ambventa).autoNumeric('init')
            $mydcompra.text(api.mydcompra).autoNumeric('init')
            $mydventa.text(api.mydventa).autoNumeric('init')
            $cuanto.autoNumeric('init')
            $updated.text(json.updated)

            cb(api)
        })
    }

    $(document).ready(function () {

        $.extend($.fn.autoNumeric.defaults, {
            aSep: '.',
            aDec: ',',
            aPad: 'false',
            aSign: 'â‚² ',
        })

        getCoti(function (data) {
            $inputStream.subscribe(
                function (e) {
                    console.log("value from obs", e.target.value)
                    var currentVal = $cuanto.autoNumeric('get')
                    var valor = currentVal == 0 ? 1 : currentVal

                    $refbcp.autoNumeric('destroy')
                    $refbcp.text(valor * data.refbcp).autoNumeric('init')
                    $cbcp.autoNumeric('destroy')
                    $cbcp.text(valor * data.cbcp).autoNumeric('init')
                    $vbcp.autoNumeric('destroy')
                    $vbcp.text(valor * data.vbcp).autoNumeric('init')
                    $refbcp.autoNumeric('destroy')
                    $refbcp.text(valor * data.refbcp).autoNumeric('init')
                    $cchaco.autoNumeric('destroy')
                    $cchaco.text(valor * data.cchaco).autoNumeric('init')
                    $vchaco.autoNumeric('destroy')
                    $vchaco.text(valor * data.vchaco).autoNumeric('init')
                    $cmaxi.autoNumeric('destroy')
                    $cmaxi.text(valor * data.cmaxi).autoNumeric('init')
                    $vmaxi.autoNumeric('destroy')
                    $vmaxi.text(valor * data.vmaxi).autoNumeric('init')
                    $calberdi.autoNumeric('destroy')
                    $calberdi.text(valor * data.calberdi).autoNumeric('init')
                    $valberdi.autoNumeric('destroy')
                    $valberdi.text(valor * data.valberdi).autoNumeric('init')
                    $cset.autoNumeric('destroy')
                    $cset.text(valor * data.cset).autoNumeric('init')
                    $vset.autoNumeric('destroy')
                    $vset.text(valor * data.vset).autoNumeric('init')
                    $intcompra.autoNumeric('destroy')
                    $intcompra.text(valor * data.intcompra).autoNumeric('init')
                    $intventa.autoNumeric('destroy')
                    $intventa.text(valor * data.intventa).autoNumeric('init')
                    $ambcompra.autoNumeric('destroy')
                    $ambcompra.text(valor * data.ambcompra).autoNumeric('init')
                    $ambventa.autoNumeric('destroy')
                    $ambventa.text(valor * data.ambventa).autoNumeric('init')
                    $mydcompra.autoNumeric('destroy')
                    $mydcompra.text(valor * data.mydcompra).autoNumeric('init')
                    $mydventa.autoNumeric('destroy')
                    $mydventa.text(valor * data.mydventa).autoNumeric('init')

                },
                function (err) {
                    console.log(err);
                },
                function () {
                    console.log('Completed');
                })
        })
    })
})($)
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68660646-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
